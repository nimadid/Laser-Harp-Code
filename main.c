#define PART_TM4C123GH6PM 1

#include <stdint.h>
#include <stdbool.h>
#include "stdio.h"
#include "stdlib.h"
#include "inc/hw_types.h"
#include "inc/hw_memmap.h"
#include "inc/hw_ints.h"
#include "inc/hw_i2c.h"
#include "inc/hw_nvic.h"
#include "inc/hw_sysctl.h"
#include "inc/hw_gpio.h"
#include "driverlib/interrupt.h"
#include "driverlib/sysctl.h"
#include "driverlib/gpio.h"
#include "driverlib/adc.h"
#include "driverlib/i2c.h"
#include "driverlib/timer.h"
#include "driverlib/pin_map.h"
#include "driverlib/debug.h"
#include "driverlib/uart.h"

uint8_t slaveAddButtonIn = 0x20;	// address for input button data
uint8_t slaveAddSensor = 0x21;      // address for sensor slave
uint8_t slaveAddLED = 0x22;	 	    // address for LED slave
uint8_t slaveAddButtonOut = 0x23;   // address for output button data

/*********  Data for teach and listen modes  ***********/
uint8_t TwinkleData0[] = {0x02, 0x02, 0x20, 0x20, 0x40, 0x40, 0x20, 0x10, 0x10, 0x08, 0x08, 0x04, 0x04, 0x02, 0x20, 0x20, 0x10, 0x10, 0x08, 0x08, 0x04, 0x20, 0x20, 0x10, 0x10, 0x08, 0x08, 0x04, 0x02, 0x02, 0x20, 0x20, 0x40, 0x40, 0x20, 0x10, 0x10, 0x08, 0x08, 0x04, 0x04, 0x02};
uint8_t TwinkleData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char TwinkleNotes[] = {60, 60, 67, 67, 69, 69, 67, 65, 65, 64, 64, 62, 62, 60, 67, 67, 65, 65, 64, 64, 62, 67, 67, 65, 65, 64, 64, 62, 60, 60, 67, 67, 69, 69, 67, 65, 65, 64, 64, 62, 62, 60};
double TwinkleWaits[] = {4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 2};
int TwinkleNum = 42;

uint8_t MaryData0[] = {0x08, 0x04, 0x02, 0x04, 0x08, 0x08, 0x08, 0x04, 0x04, 0x04, 0x08, 0x20, 0x20, 0x08, 0x04, 0x02, 0x04, 0x08, 0x08, 0x08, 0x08, 0x04, 0x04, 0x08, 0x04, 0x02};
uint8_t MaryData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char MaryNotes[] = {64, 62, 60, 62, 64, 64, 64, 62, 62, 62, 64, 67, 67, 64, 62, 60, 62, 64, 64, 64, 64, 62, 62, 64, 62, 60};
double MaryWaits[] = {4, 4, 4, 4, 4, 4, 2, 4, 4, 2, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1};
int MaryNum = 26;

uint8_t OdeData0[] = {0x40, 0x40, 0x80, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x10, 0x20, 0x40, 0x40, 0x20, 0x20, 0x40, 0x40, 0x80, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x10, 0x20, 0x40, 0x20, 0x10, 0x10};
uint8_t OdeData1[] = {0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char OdeNotes[] = {64, 64, 65, 67, 67, 65, 64, 62, 60, 60, 62, 64, 64, 62, 62, 64, 64, 65, 67, 67, 65, 64, 62, 60, 60, 62, 64, 62, 60, 60};
double OdeWaits[] = {4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 8, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 8, 2};
int OdeNum = 30;

uint8_t MuffinData0[] = {0x02, 0x10, 0x10, 0x20, 0x40, 0x10, 0x10, 0x08, 0x04, 0x20, 0x20, 0x10, 0x08, 0x02, 0x02, 0x02, 0x10, 0x10, 0x20, 0x40, 0x10, 0x10, 0x10, 0x20, 0x20, 0x02, 0x02, 0x10};
uint8_t MuffinData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char MuffinNotes[] = {60, 65, 65, 67, 69, 65, 65, 64, 62, 67, 67, 65, 64, 60, 60, 60, 65, 65, 67, 69, 65, 65, 65, 67, 67, 60, 60, 65};
double MuffinWaits[] = {8, 8, 6, 16, 8, 8, 6, 16, 8, 8, 6, 16, 8, 8, 4, 8, 8, 6, 16, 8, 8, 8, 8, 8, 8, 8, 8, 2};
int MuffinNum = 28;

//uint8_t AdamsData0[] = {0x08, 0x40, 0x00, 0x40, 0x20, 0x10, 0x80, 0x40, 0x20, 0x80, 0x20, 0x08, 0x02, 0x40, 0x08, 0x40, 0x00, 0x40, 0x20, 0x10, 0x80, 0x40, 0x20, 0x08, 0x10, 0x20, 0x40, 0x08, 0x10, 0x20, 0x40, 0x10, 0x20, 0x40, 0x80, 0x08, 0x10, 0x20, 0x40, 0x08, 0x10, 0x20, 0x40, 0x08, 0x10, 0x20, 0x40};
//uint8_t AdamsData1[] = {0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
//char AdamsNotes[] = {60, 65, 69, 65, 64, 62, 67, 65, 64, 67, 64, 60, 57, 65, 60, 65, 69, 65, 64, 62, 67, 65, 64, 60, 62, 64, 65, 60, 62, 64, 65, 62, 64, 65, 67, 60, 62, 64, 65, 60, 62, 64, 65, 60, 62, 64, 65};
//double AdamsWaits[] = {12, 6, 12, 6, 12, 6, 4, 12, 6, 12, 6, 12, 6, 4, 12, 6, 12, 6, 12, 6, 4, 12, 6, 12, 6, 12, 4, 12, 12, 12, 1.33333, 12, 12, 12, 1.33333, 12, 12, 12, 4, 12, 12, 12, 4, 12, 12, 12, 1};
//int AdamsNum = 47;

//Vivaldi's Spring (Four Seasons) fscale
//uint8_t AdamsData0[] = {0x08, 0x20, 0x20, 0x20, 0x10, 0x08, 0x80, 0x80, 0x40, 0x20, 0x20, 0x20, 0x10, 0x08, 0x80, 0x80, 0x40, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x08, 0x80, 0x40, 0x20, 0x40, 0x80, 0x00, 0x80, 0x08, 0x80, 0x40, 0x20, 0x40, 0x80, 0x00, 0x80, 0x08, 0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x10, 0x10, 0x08};
//uint8_t AdamsData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
//char AdamsNotes[] = {60, 64, 64, 64, 62, 60, 67, 67, 65, 64, 64, 64, 62, 60, 67, 67, 65, 64, 65, 67, 65, 64, 62, 60, 67, 65, 64, 65, 67, 69, 67, 60, 67, 65, 64, 65, 67, 69, 67, 60, 69, 67, 65, 64, 62, 60, 62, 62, 60};
//double AdamsWaits[] = {4, 4, 4, 4, 8, 8, 2.666, 8, 8, 4, 4, 4, 8, 8, 2.666, 8, 8, 4, 8, 8, 4, 4, 4, 4, 4, 4, 4, 8, 8, 4, 4, 4, 2, 4, 4, 8, 8, 4, 4, 4, 2, 4, 4, 2, 4, 4, 8, 8, 2.666, 8, 2};
//int AdamsNum = 49;

//London bridge
uint8_t AdamsData0[] = {0x20, 0x40, 0x20, 0x10, 0x08, 0x10, 0x20, 0x04, 0x08, 0x10, 0x08, 0x10, 0x20, 0x20, 0x40, 0x20, 0x10, 0x08, 0x10, 0x20, 0x04, 0x20, 0x04, 0x02};
uint8_t AdamsData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char AdamsNotes[] = {67, 69, 67, 65, 64, 65, 67, 62, 64, 65, 64, 65, 67, 67, 69, 67, 65, 64, 65, 67, 62, 67, 64, 60};
double AdamsWaits[] = {5.3333, 16, 8, 8, 8, 8, 4, 8, 8, 4, 8, 8, 4, 5.3333, 16, 8, 8, 8, 8, 4, 4, 4, 8, 2.6666};
int AdamsNum = 24;

//uint8_t LetGoData0[] = {0xFB, 0xF7, 0xEF, 0xFD, 0xFD, 0xDF, 0xEF, 0xFB, 0xFB, 0xFB, 0xFB, 0xF7, 0xEF, 0xFB, 0xF7, 0xEF, 0xFD, 0xFD, 0xDF, 0xEF, 0xDF, 0xBF, 0xBF, 0x7F, 0xBF, 0xDF, 0xEF, 0xDF, 0xEF, 0xEF, 0xFF, 0xBF, 0xDF, 0xEF, 0xFF, 0xBF, 0xEF, 0xEF, 0xEF, 0xF7, 0xFD, 0xFD, 0xBF, 0x7F, 0x7F, 0xBF, 0x7F, 0xBF, 0x7F, 0x7F, 0xBF, 0xEF};
//uint8_t LetGoData0[] = {0x04, 0x08, 0x10, 0x02, 0x02, 0x20, 0x10, 0x04, 0x04, 0x04, 0x04, 0x08, 0x10, 0x04, 0x08, 0x10, 0x02, 0x02, 0x20, 0x10, 0x20, 0x40, 0x40, 0x80, 0x40, 0x20, 0x10, 0x20, 0x10, 0x10, 0x00, 0x40, 0x20, 0x10, 0x00, 0x40, 0x10, 0x10, 0x10, 0x08, 0x02, 0x02, 0x40, 0x80, 0x80, 0x40, 0x80, 0x40, 0x80, 0x80, 0x40, 0x10};
//uint8_t LetGoData1[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
//uint8_t LetGoData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
//char LetGoNotes[] = {57, 59, 60, 55, 55, 62, 60, 57, 57, 57, 57, 59, 60, 57, 59, 60, 55, 55, 62, 60, 62, 64, 64, 65, 64, 62, 60, 62, 60, 60, 67, 64, 62, 60, 67, 64, 60, 60, 60, 59, 55, 55, 64, 65, 65, 64, 65, 64, 65, 65, 64, 60};
//double LetGoWaits[] = {8, 8, 1.333333, 8, 8, 1.142857, 4, 8, 8, 4, 8, 4, 1.333333, 8, 8, 1.333333, 8, 8, 1.142857, 8, 8, 8, 4, 4, 8, 8, 8, 8, 1.333333, 8, 2.666667, 2.666667, 1, 4, 2.666667, 2.666667, 1, 8, 8, 2.666667, 2.666667, 0.888889, 8, 4, 8, 8, 8, 8, 8, 8, 8, 1.333333};
//int LetGoNum = 52;

//But really Yankee Doodle
uint8_t LetGoData0[] = {0x10, 0x10, 0x20, 0x40, 0x10, 0x40, 0x20, 0x02, 0x10, 0x10, 0x20, 0x40, 0x10, 0x08, 0x10, 0x10, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x08, 0x02, 0x04, 0x08, 0x10, 0x10};
uint8_t LetGoData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char LetGoNotes[] = {60, 60, 62, 64, 60, 64, 62, 55, 60, 60, 62, 64, 60, 59, 60, 60, 62, 64, 65, 64, 62, 60, 59, 55, 57, 59, 60, 60};
double LetGoWaits[] = {4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 2};
int LetGoNum = 28;

//uint8_t FightData0[] = {0x08, 0x04, 0x02, 0x01, 0x02, 0x01, 0x02, 0x10, 0x10, 0x10, 0x10, 0x08, 0x04, 0x02, 0x04, 0x02, 0x04, 0x20, 0x20, 0x20, 0x02, 0x08, 0x20, 0x00, 0x80, 0x40, 0x10, 0x01, 0x04, 0x10, 0x80, 0x40, 0x20, 0x08, 0x20, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01, 0x02, 0x01, 0x02, 0x01, 0x10, 0x10, 0x10, 0x08, 0x04, 0x02, 0x04, 0x02, 0x04, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x80, 0x80, 0x00, 0x20, 0x20, 0x10, 0x04, 0x20, 0x40, 0x80, 0x80, 0x00};
//uint8_t FightData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
//char FightNotes[] = {64, 62, 60, 59, 60, 59, 60, 65, 65, 65, 65, 64, 62, 61, 62, 61, 62, 67, 67, 67, 60, 64, 67, 72, 71, 69, 65, 59, 62, 65, 71, 69, 67, 64, 67, 66, 65, 64, 62, 60, 59, 60, 59, 60, 65, 65, 65, 65, 64, 62, 61, 62, 61, 62, 67, 67, 67, 67, 69, 69, 71, 71, 72, 67, 66, 65, 62, 67, 69, 71, 71, 72};
//double FightWaits[] = {16, 8, 16, 16, 16, 16, 16, 8, 8, 4, 16, 8, 16, 16, 16, 16, 16, 8, 8, 4, 8, 8, 8, 2.66666, 8, 16, 4, 8, 8, 8, 2.66666, 8, 16, 16, 16, 16, 16, 16, 8, 16, 16, 16, 16, 16, 8, 8, 4, 16, 8, 16, 16, 16, 16, 16, 8, 8, 8, 8, 2.66666, 16, 2.66666, 16, 8, 8, 8, 8, 16, 8, 16, 8, 8, 3.2};
//int FightNum = 72;

//But really this old man
uint8_t FightData0[] = {0x20, 0x08, 0x20, 0x20, 0x08, 0x20, 0x40, 0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x08, 0x10, 0x20, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0x08, 0x10, 0x20, 0x20, 0x04, 0x04, 0x10, 0x08, 0x04, 0x02};
uint8_t FightData1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char FightNotes[] = {67, 64, 67, 67, 64, 67, 69, 67, 65, 64, 62, 64, 65, 64, 65, 67, 60, 60, 60, 60, 60, 62, 64, 65, 67, 67, 62, 62, 65, 64, 62, 60};
double FightWaits[] = {4, 4, 2, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 8, 8, 4, 4, 8, 8, 4, 8, 8, 8, 8, 2, 4, 4, 4, 4, 4, 4, 2};
int FightNum = 32;

uint8_t HeartData0[] = {0x10, 0x20, 0x02, 0x00, 0x80, 0x40, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x08, 0x10, 0x08, 0x04, 0x02, 0x10, 0x20, 0x02, 0x00, 0x80, 0x40, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x08, 0x10, 0x08, 0x08, 0x10, 0x20, 0x40, 0x20, 0x10};
uint8_t HeartData1[] = {0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
char HeartNotes[] = {60, 62, 55, 67, 65, 64, 62, 64, 65, 64, 62, 60, 59, 60, 59, 57, 55, 60, 62, 55, 67, 65, 64, 62, 64, 65, 64, 62, 60, 59, 60, 59, 59, 60, 62, 64, 62, 60};
double HeartWaits[] = {2, 2.66666, 8, 4, 8, 16, 3.2, 5.33333, 16, 4, 5.33333, 16, 8, 3.2, 16, 2, 2, 2, 2.66666, 8, 4, 8, 16, 3.2, 8, 8, 4, 5.33333, 16, 8, 3.2, 16, 8, 4, 8, 4, 4, 2};
int HeartNum = 38;

char instrument = 0x01;   		       // harp instrument
char channel1 = 0, channel2 = 1, channel3 = 2, channel4 = 3, channel5 = 4, channel6 = 5, channel7 = 6, channel8 = 7, channel9 = 8;
char attackVel = 60, releaseVel = 60;  // default attack/release velocity

int i;
int noteVals[9];
char playNotes[9];
char cScale[] = {59, 60, 62, 64, 65, 67, 69, 71, 72};
char fScale[] = {53, 55, 57, 59, 60, 62, 64, 65, 67};
char adamsScale[] = {55, 57, 59, 60, 62, 64, 65, 67, 69};

int mode = 1, songChoice = 1;
int songFlag = 1, modeFlag = 1;
int prevSong = 1, prevMode = 1;
int busyFlag = 0;
uint32_t volData;

int intFlag = 0;
int noPlay = 1;
int cancel;

uint8_t sensorVal[2];	 // data from sensors
uint8_t buttonData;		 // data from button pad
uint8_t writeData[2];	 // data to write to LEDs

#include "initialization.h"
#include "MIDI.h"
#include "I2Cfunc.h"
#include "UARTfunc.h"
#include "checkNote.h"
#include "buttons.h"
#include "teachSongs.h"
#include "listenSongs.h"

// interrupt for polling buttons and MIDI reset
void Timer0IntHandler(void)
{
  TimerIntClear(TIMER0_BASE, TIMER_TIMA_TIMEOUT);

  checkVolume(&volData);  		// store volume data from knob in volData
  setVolume();					// set the volume on each channel
  if(GPIOPinRead(GPIO_PORTF_BASE,GPIO_PIN_4)==0x00) {
	resetMIDI();
  }

  if (busyFlag) {
	 cancel = checkCancel();
  }
  else {
	 cancel = 0;
	 pollButtons();				// check if button on button pad is pushed
  }
}

// Interrupt handler for sensors
void IntGPIOb (void){
  GPIOIntClear(GPIO_PORTB_BASE, GPIO_PIN_0);
  noPlay = 1;

  I2CRead16(slaveAddSensor);

  for (i = 0; i < 9; i++)
	noteVals[i] = 0;

  checkNote(sensorVal, noteVals);
  for (i = 0; i < 9; i++) {
	  if (noteVals[i]) {
		  noPlay = 0;
		  break;
	  }
  }

  intFlag = 1;
}

int main(void)
{
	SysCtlClockSet(SYSCTL_SYSDIV_5|SYSCTL_USE_OSC|SYSCTL_XTAL_16MHZ|SYSCTL_OSC_MAIN);    // Set system clock to run at 40MHz

	initialization();	// Initialize all pins on the microcontroller
	defaultScreen();	// Print default screen on LCD

	// set default volume of 127 on each channel
    talkMIDI(0xB0, 0x07, 127);
    talkMIDI(0xB1, 0x07, 127);
    talkMIDI(0xB2, 0x07, 127);
    talkMIDI(0xB3, 0x07, 127);
    talkMIDI(0xB4, 0x07, 127);
    talkMIDI(0xB5, 0x07, 127);
    talkMIDI(0xB6, 0x07, 127);
    talkMIDI(0xB7, 0x07, 127);
    talkMIDI(0xB8, 0x07, 127);

    talkMIDI(0xB0, 0, 0x00);         // select default bank
    talkMIDI(0xC0, instrument, 0);   // select instrument for each channel
    talkMIDI(0xC1, instrument, 0);
    talkMIDI(0xC2, instrument, 0);
    talkMIDI(0xC3, instrument, 0);
    talkMIDI(0xC4, instrument, 0);
    talkMIDI(0xC5, instrument, 0);
    talkMIDI(0xC6, instrument, 0);
    talkMIDI(0xC7, instrument, 0);
    talkMIDI(0xC8, instrument, 0);

    // select default note scale
    for (i = 0; i < 9; i++)
    	playNotes[i] = cScale[i];

	writeData[0] = 0x00; writeData[1] = 0x00;
	I2CWrite16(writeData, slaveAddLED);	// turn all LEDs off

	while(1)
	{
		  // free play mode
          if (mode == 1) {
		    if (intFlag) {
			  intFlag = 0;
			  if (noPlay){
				  stopNote(channel1, playNotes[0], releaseVel);
				  stopNote(channel2, playNotes[1], releaseVel);
				  stopNote(channel3, playNotes[2], releaseVel);
				  stopNote(channel4, playNotes[3], releaseVel);
				  stopNote(channel5, playNotes[4], releaseVel);
				  stopNote(channel6, playNotes[5], releaseVel);
				  stopNote(channel7, playNotes[6], releaseVel);
				  stopNote(channel8, playNotes[7], releaseVel);
				  stopNote(channel9, playNotes[8], releaseVel);
			  }
			  else {
				  if (noteVals[0])
					playNote(channel1, playNotes[0], attackVel);
				  else
					stopNote(channel1, playNotes[0], releaseVel);

				  if (noteVals[1])
					playNote(channel2, playNotes[1], attackVel);
				  else
					stopNote(channel2, playNotes[1], releaseVel);

				  if (noteVals[2])
					playNote(channel3, playNotes[2], attackVel);
				  else
					stopNote(channel3, playNotes[2], releaseVel);

				  if (noteVals[3])
					playNote(channel4, playNotes[3], attackVel);
				  else
					stopNote(channel4, playNotes[3], releaseVel);

				  if (noteVals[4])
					playNote(channel5, playNotes[4], attackVel);
				  else
					stopNote(channel5, playNotes[4], releaseVel);

				  if (noteVals[5])
					playNote(channel6, playNotes[5], attackVel);
				  else
					stopNote(channel6, playNotes[5], releaseVel);

				  if (noteVals[6])
					playNote(channel7, playNotes[6], attackVel);
				  else
					stopNote(channel7, playNotes[6], releaseVel);

				  if (noteVals[7])
					playNote(channel8, playNotes[7], attackVel);
				  else
					stopNote(channel8, playNotes[7], releaseVel);

				  if (noteVals[8])
					playNote(channel9, playNotes[8], attackVel);
				  else
					stopNote(channel9, playNotes[8], releaseVel);
			  }
		  }
	  }

	  // Teach mode
	  else if (mode == 2) {
	    if (songChoice == 1) {
	      for (i = 0; i < 9; i++)
	    	  playNotes[i] = cScale[i];
          playSong(TwinkleData0, TwinkleData1, TwinkleNotes, TwinkleWaits, TwinkleNum);
	    }
	    else if (songChoice == 2) {
	      for (i = 0; i < 9; i++)
	          playNotes[i] = cScale[i];
	      playSong(MaryData0, MaryData1, MaryNotes, MaryWaits, MaryNum);
	    }
	    else if (songChoice == 3) {
	      for (i = 0; i < 9; i++)
	          playNotes[i] = fScale[i];
	      playSong(OdeData0, OdeData1, OdeNotes, OdeWaits, OdeNum);
	      for (i = 0; i < 9; i++)
	      	  playNotes[i] = cScale[i];
	    }
	    else if (songChoice == 4) {
		  for (i = 0; i < 9; i++)
		      playNotes[i] = cScale[i];
	      playSong(MuffinData0, MuffinData1, MuffinNotes, MuffinWaits, MuffinNum);
	    }
	    else if (songChoice == 5) {
		   for (i = 0; i < 9; i++)
		      playNotes[i] = cScale[i];
	      playSong(AdamsData0, AdamsData1, AdamsNotes, AdamsWaits, AdamsNum);
	    }
	    else if (songChoice == 6) {
		  for (i = 0; i < 9; i++)
		      playNotes[i] = fScale[i];
	      playSong(LetGoData0, LetGoData1, LetGoNotes, LetGoWaits, LetGoNum);
	      for (i = 0; i < 9; i++)
	      	  playNotes[i] = cScale[i];
	    }
	    else if (songChoice == 7) {
		  for (i = 0; i < 9; i++)
		      playNotes[i] = cScale[i];
	      playSong(FightData0, FightData1, FightNotes, FightWaits, FightNum);
	    }
	    else if (songChoice == 8) {
	      for (i = 0; i < 9; i++)
			  playNotes[i] = fScale[i];
	      playSong(HeartData0, HeartData1, HeartNotes, HeartWaits, HeartNum);
		  for (i = 0; i < 9; i++)
		      playNotes[i] = cScale[i];
	    }
		mode = 1;
		modeFlag = 1;
		busyFlag = 0;
		defaultScreen();
		writeData[0] = 0x00; writeData[1] = 0x00;
		I2CWrite16(writeData, slaveAddLED);	// turn all LEDs off
	  }

	  // Listen mode
	  else if (mode == 3) {
	    if (songChoice == 1) {
		  listenSong(TwinkleData0, TwinkleData1, TwinkleNotes, TwinkleWaits, TwinkleNum);
 	    }
  	    else if (songChoice == 2) {
  	      listenSong(MaryData0, MaryData1, MaryNotes, MaryWaits, MaryNum);
  	    }
  	    else if (songChoice == 3) {
  	      listenSong(OdeData0, OdeData1, OdeNotes, OdeWaits, OdeNum);
  	    }
  	    else if (songChoice == 4) {
  	      listenSong(MuffinData0, MuffinData1, MuffinNotes, MuffinWaits, MuffinNum);
  	    }
  	    else if (songChoice == 5) {
  	      listenSong(AdamsData0, AdamsData1, AdamsNotes, AdamsWaits, AdamsNum);
  	    }
  	    else if (songChoice == 6) {
  	      listenSong(LetGoData0, LetGoData1, LetGoNotes, LetGoWaits, LetGoNum);
  	    }
  	    else if (songChoice == 7) {
  	      listenSong(FightData0, FightData1, FightNotes, FightWaits, FightNum);
  	    }
 	    else if (songChoice == 8) {
  	      listenSong(HeartData0, HeartData1, HeartNotes, HeartWaits, HeartNum);
  	    }
	    mode = 1;
	    modeFlag = 1;
	    busyFlag = 0;
	    defaultScreen();
		writeData[0] = 0x00; writeData[1] = 0x00;
		I2CWrite16(writeData, slaveAddLED);	// turn all LEDs off
	  }
	}
}
